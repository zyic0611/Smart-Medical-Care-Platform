# 1. ğŸŒŸ å…³é”®ä¿®æ”¹ï¼šé”å®šä½¿ç”¨ Debian 12 (bookworm) ç‰ˆæœ¬
# è¿™æ ·èƒ½ç¡®ä¿è½¯ä»¶åŒ…åç§°ç¨³å®šï¼Œä¸ä¼šè«åå…¶å¦™æ¶ˆå¤±
FROM python:3.9-slim-bookworm

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# 2. ğŸŒŸ å…³é”®ä¿®æ”¹ï¼šæ›¿æ¢æºå¹¶å®‰è£…ä¾èµ–
# - æŠŠ libgl1-mesa-glx æ”¹ä¸º libgl1
# - bookworm æºé‡ŒåŒ…å« openjdk-17ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨
RUN sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list.d/debian.sources && \
    apt-get update && apt-get install -y \
    openjdk-17-jre-headless \
    libgl1 \
    libglib2.0-0 \
    && rm -rf /var/lib/apt/lists/*

# è®¾ç½® JAVA_HOME (Bookworm é‡Œçš„è·¯å¾„)
ENV JAVA_HOME="/usr/lib/jvm/java-17-openjdk-amd64"

# å¤åˆ¶ä¾èµ–å¹¶å®‰è£…
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# å¤åˆ¶æ‰€æœ‰ä»£ç 
COPY . .

# é»˜è®¤æŒ‡ä»¤
CMD ["python", "medical_ai_api.py"]